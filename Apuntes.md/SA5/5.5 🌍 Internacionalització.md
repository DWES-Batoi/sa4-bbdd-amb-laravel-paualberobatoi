# 5. üåç Internacionalitzaci√≥

> En aquest apartat afegirem **Catal√† (ca)**, **Castell√† (es)** i **Angl√®s (en)**, i permetrem canviar l‚Äôidioma des del men√∫.

---

## 5.1. Publicar fitxers de llenguatge i afegir idiomes

1.- lang:publish -> Preparar el directori de lleng√ºes del projecte
2.- require laravel-lang/lang --dev -> Aporta traduccions comunit√†ries per molts idiomes (incl√≤s es, ca, etc.) per a textos t√≠pics de Laravel (validaci√≥, errors, auth, pagination‚Ä¶).
3.- lang:add es y lang:add ca ->Afegeix l‚Äôidioma espanyol i catal√† al directori lang/ 

Executa:
```bash
make artisan CMD="lang:publish"
make composer CMD="require laravel-lang/lang --dev"
make artisan CMD="lang:add es"
make artisan CMD="lang:add ca"
```

Aix√≤ et crear√†/omplir√† fitxers com:

- `lang/es.json`
- `lang/ca.json`


---

## 5.2. Configurar l‚Äôidioma per defecte

Edita el fitxer `.env` i posa aix√≤ que significa idioma per defecte i idioma si falta alguna traducci√≥:

```env
APP_LOCALE=ca
APP_FALLBACK_LOCALE=en
```

Neteja cach√©s de configuraci√≥ (recomanat):

```bash
make artisan CMD="optimize:clear"
```

---

## 5.3. Definir traduccions (JSON)

Crea o edita els fitxers:

### `lang/ca.json`

```json
{
  "Guia d'Equips": "Guia d'Equips",
  "Crear Equip": "Crear Equip",
  "Nom": "Nom",
  "Estadi": "Estadi",
  "Titols": "T√≠tols",
  "Accions": "Accions",
  "Segur que vols eliminar aquest equip?": "Segur que vols eliminar aquest equip?",
  "Catal√†": "Catal√†",
  "Castellano": "Castell√†",
  "English": "Angl√®s"
}
```

### `lang/es.json`

```json
{
  "Guia d'Equips": "Gu√≠a de Equipos",
  "Crear Equip": "Crear Equipo",
  "Nom": "Nombre",
  "Estadi": "Estadio",
  "Titols": "T√≠tulos",
  "Accions": "Acciones",
  "Segur que vols eliminar aquest equip?": "¬øSeguro que quieres eliminar este equipo?",
  "Catal√†": "Catal√°n",
  "Castellano": "Castellano",
  "English": "Ingl√©s"
}
```

### `lang/en.json`
Sino tens lang/en.json ho has de crear amb aquest contingut, ho he possat de castell√† a Angl√©s y de Valenci√† a Angl√©s per si de cas.


```json
{
  "Guia d'Equips": "Teams Guide",
  "Crear Equip": "Create Team",
  "Nom": "Name",
  "Estadi": "Stadium",
  "Titols": "Titles",
  "Accions": "Actions",
  "Segur que vols eliminar aquest equip?": "Are you sure you want to delete this team?",
  "Catal√†": "Catalan",
  "Castellano": "Spanish",
  "English": "English",
  "Gu√≠a de Equipos": "Teams Guide",
  "Crear Equipo": "Create Team",
  "Nombre": "Name",
  "Estadio": "Stadium",
  "T√≠tulos": "Titles",
  "Acciones": "Actions",
  "¬øSeguro que quieres eliminar este equipo?": "Are you sure you want to delete this team?",
  "Catal√°n": "Catalan",
  "Castellano": "Spanish",
  "Ingl√©s": "English"
}
```

---

## 5.4. Recuperar cadenes de traducci√≥ a les vistes

A qualsevol vista Blade, has d¬¥utilitzar `__()` per a que els textos es pueguen tradu√Ør autom√†ticament.
Fes una copia del les vistes abans de modificarles i prepararles per a les traduccions.

Exemple: `resources/views/equips/index.blade.php`

```blade
@extends('layouts.equip')

@section('title', __('Equips'))

@section('content')
<div class="container">
  <h1 class="title">{{ __('Llistat d\'equips') }}</h1>

  <div class="grid-cards">
    @foreach ($equips as $equip)
      <article class="card">
        <header class="card__header">
          <h2 class="card__title">{{ $equip->nom }}</h2>
          <span class="card__badge">{{ __('ID') }}: {{ $equip->id }}</span>
        </header>

        <div class="card__body">
          <p><strong>{{ __('Ciutat') }}:</strong> {{ $equip->ciutat ?? '‚Äî' }}</p>
          <p><strong>{{ __('Estadi') }}:</strong> {{ $equip->estadi->nom ?? '‚Äî' }}</p>
        </div>

        <footer class="card__footer">
          <a class="btn btn--ghost" href="{{ route('equips.show', $equip) }}">{{ __('Veure') }}</a>
          <a class="btn btn--primary" href="{{ route('equips.edit', $equip) }}">{{ __('Editar') }}</a>

          <form method="POST"
                action="{{ route('equips.destroy', $equip) }}"
                class="inline"
                onsubmit="return confirm('{{ __('Segur que vols eliminar aquest equip?') }}');">
            @csrf
            @method('DELETE')
            <button class="btn btn--danger" type="submit">{{ __('Eliminar') }}</button>
          </form>
        </footer>
      </article>
    @endforeach
  </div>
</div>
@endsection

```
NOTA: Ho has de fer en totes les vistes. 

---

## 5.5. Canviar l‚Äôidioma din√†micament

### 5.5.1. Ruta per canviar idioma
Localitza la part que √∫nicament has de canviar en el teu fitxer web.php perque en el exemple no est√† ni jugadores, ni partits.

A `routes/web.php`:

```php
<?php

use App\Http\Controllers\ProfileController;
use App\Http\Controllers\EquipController;
use App\Http\Controllers\EstadiController;
use Illuminate\Support\Facades\Route;
use Illuminate\Support\Facades\Session; // üëà AFEGEIX AIX√í

Route::get('/', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    return view('dashboard');
})->middleware(['auth', 'verified'])->name('dashboard');


// ‚úÖ Ruta per canviar idioma (i18n) üëà AFEGEIX AIX√í
Route::get('/locale/{locale}', function (string $locale) {
    $available = ['ca', 'es', 'en'];

    if (!in_array($locale, $available, true)) {
        $locale = config('app.fallback_locale', 'en');
    }

    Session::put('locale', $locale);

    return redirect()->back();
})->name('setLocale');


// ‚úÖ P√∫blicos: SOLO index (para evitar conflicto con /create)
Route::resource('equips', EquipController::class)->only(['index']);
Route::resource('estadis', EstadiController::class)->only(['index']);


// üîí Protegidos: crear/editar/borrar (y store/update/destroy)
Route::middleware('auth')->group(function () {

    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');

    Route::resource('equips', EquipController::class)->except(['index', 'show']);
    Route::resource('estadis', EstadiController::class)->except(['index', 'show']);
});


// ‚úÖ P√∫blicos: show AL FINAL (as√≠ /create no lo captura {id})
Route::resource('equips', EquipController::class)->only(['show']);
Route::resource('estadis', EstadiController::class)->only(['show']);

require __DIR__.'/auth.php';

```

---

## 5.6. Middleware SetLocale

Middleware crea un fitxer nou de middleware al projecte: `app/Http/Middleware/SetLocale.php`

I dins et posa una plantilla b√†sica amb el m√®tode handle() (buit / per defecte), perqu√® tu despr√©s li poses la l√≤gica.

Qu√® √©s un middleware i per a qu√® el vols ac√≠? Un middleware √©s un ‚Äúfiltre‚Äù que s‚Äôexecuta abans (i/o despr√©s) de cada request web. En el cas SetLocale, la idea √©s:

1.- llegir l‚Äôidioma guardat en Session (ex. ca, es, en)

2.- fer App::setLocale($locale) i aix√≠ totes les vistes i missatges d‚Äôaquella petici√≥ ixen en eixe idioma, sino Laravel no canviaria autom√†ticament l‚Äôidioma a cada p√†gina.
Recorda que APPLOCALE le em configurat al inici d'aquesta pr√†ctica per defecte.'

### 5.6.1. Crear el middleware (amb Makefile)

```bash
make artisan CMD="make:middleware SetLocale"
```

### 5.6.2. Implementar el middleware

Fitxer: `app/Http/Middleware/SetLocale.php`

```php
<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\App;
use Illuminate\Support\Facades\Session;

class SetLocale
{
    public function handle($request, Closure $next)
    {
        $locale = Session::get('locale', config('app.locale'));
        App::setLocale($locale);

        return $next($request);
    }
}
```

---

## 5.7. Activar el middleware en Laravel 12 (bootstrap/app.php)

Edita `bootstrap/app.php` i afegeix el middleware al grup `web`:

```php
<?php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Exceptions;
use Illuminate\Foundation\Configuration\Middleware;
use App\Http\Middleware\SetLocale; // üëà AFEGEIX AIX√í

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        web: __DIR__.'/../routes/web.php',
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    ->withMiddleware(function (Middleware $middleware): void {
        // üëá AFEGEIX AIX√í
        $middleware->appendToGroup('web', SetLocale::class);
    })
    ->withExceptions(function (Exceptions $exceptions): void {
        //
    })->create();

```

---

## 5.8. Enlla√ßos de canvi d‚Äôidioma en el men√∫ (navigation.blade.php)

A `resources/views/layouts/navigation.blade.php` (dins del dropdown), posa:

```blade
<x-dropdown-link :href="route('setLocale','ca')">
    {{ __('Catal√†') }}
</x-dropdown-link>

<x-dropdown-link :href="route('setLocale','es')">
    {{ __('Castellano') }}
</x-dropdown-link>

<x-dropdown-link :href="route('setLocale','en')">
    {{ __('English') }}
</x-dropdown-link>
```

A continuaci√≥ mostre el navigation.blade.php. Has de tindre en compte que √∫nicamente est√† fet per a Equips i Estadis, observa a on posaras les teus Jugadores i Partits.

```
<nav x-data="{ open: false }" class="bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700">
    <!-- Primary Navigation Menu -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex">
                <!-- Logo -->
                <div class="shrink-0 flex items-center">
                    <a href="{{ auth()->check() ? route('dashboard') : url('/') }}">
                        <x-application-logo class="block h-9 w-auto fill-current text-gray-800 dark:text-gray-200" />
                    </a>
                </div>

                <!-- Navigation Links -->
                <div class="hidden space-x-8 sm:-my-px sm:ms-10 sm:flex">
                    <x-nav-link :href="route('equips.index')" :active="request()->routeIs('equips.*')">
                        {{ __('Equips') }}
                    </x-nav-link>

                    <x-nav-link :href="route('estadis.index')" :active="request()->routeIs('estadis.*')">
                        {{ __('Estadis') }}
                    </x-nav-link>

                    @auth
                        <x-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                            {{ __('Dashboard') }}
                        </x-nav-link>
                    @endauth
                </div>
            </div>

            <!-- Right side (always visible on desktop) -->
            <div class="hidden sm:flex sm:items-center sm:ms-6 space-x-4">
                {{-- üåç Idioma (sempre visible en desktop) --}}
                <div class="flex items-center gap-2">
                    <a href="{{ route('setLocale','ca') }}"
                       class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='ca' ? 'font-bold underline' : '' }}">
                        CA
                    </a>
                    <a href="{{ route('setLocale','es') }}"
                       class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='es' ? 'font-bold underline' : '' }}">
                        ES
                    </a>
                    <a href="{{ route('setLocale','en') }}"
                       class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='en' ? 'font-bold underline' : '' }}">
                        EN
                    </a>
                </div>

                @auth
                    <!-- Settings Dropdown -->
                    <x-dropdown align="right" width="48">
                        <x-slot name="trigger">
                            <button class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none transition ease-in-out duration-150">
                                <div>{{ Auth::user()->name }}</div>

                                <div class="ms-1">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </button>
                        </x-slot>

                        <x-slot name="content">
                            <x-dropdown-link :href="route('profile.edit')">
                                {{ __('Profile') }}
                            </x-dropdown-link>

                            {{-- üåç Idioma (opcional dins del dropdown tamb√©) --}}
                            <div class="border-t border-gray-100 dark:border-gray-600 my-1"></div>

                            <x-dropdown-link :href="route('setLocale','ca')">
                                {{ __('Catal√†') }}
                            </x-dropdown-link>

                            <x-dropdown-link :href="route('setLocale','es')">
                                {{ __('Castellano') }}
                            </x-dropdown-link>

                            <x-dropdown-link :href="route('setLocale','en')">
                                {{ __('English') }}
                            </x-dropdown-link>

                            <!-- Authentication -->
                            <form method="POST" action="{{ route('logout') }}">
                                @csrf

                                <x-dropdown-link :href="route('logout')"
                                        onclick="event.preventDefault();
                                                    this.closest('form').submit();">
                                    {{ __('Log Out') }}
                                </x-dropdown-link>
                            </form>
                        </x-slot>
                    </x-dropdown>
                @else
                    <a href="{{ route('login') }}" class="text-sm text-gray-700 dark:text-gray-300">
                        {{ __('Log in') }}
                    </a>

                    <a href="{{ route('register') }}" class="text-sm text-gray-700 dark:text-gray-300">
                        {{ __('Register') }}
                    </a>
                @endauth
            </div>

            <!-- Hamburger -->
            <div class="-me-2 flex items-center sm:hidden">
                <button @click="open = ! open" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-900 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-900 focus:text-gray-500 dark:focus:text-gray-400 transition duration-150 ease-in-out">
                    <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path :class="{'hidden': open, 'inline-flex': ! open }" class="inline-flex" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        <path :class="{'hidden': ! open, 'inline-flex': open }" class="hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Responsive Navigation Menu -->
    <div :class="{'block': open, 'hidden': ! open}" class="hidden sm:hidden">
        <div class="pt-2 pb-3 space-y-1">
            <x-responsive-nav-link :href="route('equips.index')" :active="request()->routeIs('equips.*')">
                {{ __('Equips') }}
            </x-responsive-nav-link>

            <x-responsive-nav-link :href="route('estadis.index')" :active="request()->routeIs('estadis.*')">
                {{ __('Estadis') }}
            </x-responsive-nav-link>

            @auth
                <x-responsive-nav-link :href="route('dashboard')" :active="request()->routeIs('dashboard')">
                    {{ __('Dashboard') }}
                </x-responsive-nav-link>
            @endauth
        </div>

        {{-- üåç Idioma (sempre visible en m√≤bil) --}}
        <div class="pt-2 pb-2 border-t border-gray-200 dark:border-gray-600">
            <div class="px-4 flex items-center gap-4">
                <a href="{{ route('setLocale','ca') }}"
                   class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='ca' ? 'font-bold underline' : '' }}">
                    CA
                </a>
                <a href="{{ route('setLocale','es') }}"
                   class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='es' ? 'font-bold underline' : '' }}">
                    ES
                </a>
                <a href="{{ route('setLocale','en') }}"
                   class="text-sm text-gray-700 dark:text-gray-300 {{ app()->getLocale()==='en' ? 'font-bold underline' : '' }}">
                    EN
                </a>
            </div>
        </div>

        <!-- Responsive Settings Options -->
        @auth
            <div class="pt-4 pb-1 border-t border-gray-200 dark:border-gray-600">
                <div class="px-4">
                    <div class="font-medium text-base text-gray-800 dark:text-gray-200">{{ Auth::user()->name }}</div>
                    <div class="font-medium text-sm text-gray-500">{{ Auth::user()->email }}</div>
                </div>

                <div class="mt-3 space-y-1">
                    <x-responsive-nav-link :href="route('profile.edit')">
                        {{ __('Profile') }}
                    </x-responsive-nav-link>

                    <!-- Authentication -->
                    <form method="POST" action="{{ route('logout') }}">
                        @csrf

                        <x-responsive-nav-link :href="route('logout')"
                                onclick="event.preventDefault();
                                            this.closest('form').submit();">
                            {{ __('Log Out') }}
                        </x-responsive-nav-link>
                    </form>
                </div>
            </div>
        @else
            <div class="pt-4 pb-1 border-t border-gray-200 dark:border-gray-600">
                <div class="mt-3 space-y-1 px-4">
                    <x-responsive-nav-link :href="route('login')">
                        {{ __('Log in') }}
                    </x-responsive-nav-link>

                    <x-responsive-nav-link :href="route('register') ">
                        {{ __('Register') }}
                    </x-responsive-nav-link>
                </div>
            </div>
        @endauth
    </div>
</nav>

```
---

## 5.9. Verificaci√≥ final

- Entra a `/equips`
- Canvia idioma des del men√∫
- Refresca la p√†gina i comprova que es mant√© l‚Äôidioma (queda guardat en **Session**)

Si no actualitza textos:

```bash
make artisan CMD="optimize:clear"
```

---
