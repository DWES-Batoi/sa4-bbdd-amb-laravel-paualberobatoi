# 5.3. üë• Afegir rols al sistema 
En este apartat afegirem un camp **`role`** a la taula `users` per a diferenciar el tipus d‚Äôusuari (per exemple: `administrador`, `arbitre`‚Ä¶).  
Despr√©s crearem un **seeder** per a generar un usuari **administrador** autom√†ticament.

> Recorda: en esta pr√†ctica farem servir el teu **Makefile** amb `make artisan CMD="..."`.

---

## 5.3.1. Crear la migraci√≥ per afegir `role` a `users`

### 1) Crear la migraci√≥ (amb make)

```bash
make artisan CMD="make:migration add_role_to_users_table --table=users"
```

Aix√≤ crear√† un fitxer dins de:

```
database/migrations/YYYY_MM_DD_HHMMSS_add_role_to_users_table.php
```

### 2) Editar la migraci√≥

Obri el fitxer creat i deixa‚Äôl aix√≠:

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->string('role')->default('arbitre');
        });
    }

    public function down(): void
    {
        Schema::table('users', function (Blueprint $table) {
            $table->dropColumn('role');
        });
    }
};
```

**Qu√® estem fent?**
- Afegim la columna `role` (text).
- Posem valor per defecte `arbitre` (si no indiquem res al crear un usuari).
- En `down()` eliminem la columna per si fem `rollback`.

### 3) Aplicar la migraci√≥ (amb make)

```bash
make artisan CMD="migrate"
```

---

## 5.3.2. Crear el seeder d‚Äôusuaris (UserSeeder)

### 1) Crear el seeder (amb make)

```bash
make artisan CMD="make:seeder UserSeeder"
```

Aix√≤ crear√†:

```
database/seeders/UserSeeder.php
```

### 2) Escriure el seeder

Obri `database/seeders/UserSeeder.php` i posa:

```php
<?php

namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    public function run(): void
    {
        User::create([
            'name' => 'Admin',
            'email' => 'admin@example.com',
            'password' => Hash::make('password'),
            'role' => 'administrador',
        ]);
    }
}
```

üìå **Detall important:** `Hash::make('password')` guarda la contrasenya encriptada (no en text pla).

---

## 5.3.3. Afegir el seeder al DatabaseSeeder

Obri `database/seeders/DatabaseSeeder.php` i afegeix `UserSeeder::class`:

```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            EstadisSeeder::class,
            EquipsSeeder::class,
            UserSeeder::class,
        ]);
    }
}
```

---

## 5.3.4. Executar els seeders (amb make)

### Opci√≥ A: executar nom√©s seeders

Abans de executar recorda que el seeders de Equips i Estadis tornen a crear dades, pots usar dins de seeders EstadisSeeder o EquipsSeeders le seg√ºents opcions:
- firstOrCreate():Si existix ‚Üí el retorna tal qual (NO actualitza res); Si no existix ‚Üí el crea amb els valors del segon array.
- updateOrCreate():Si existix ‚Üí l‚Äôactualitza amb els valors del segon array: Si no existix ‚Üí el crea amb eixos valors.

```bash
make artisan CMD="db:seed"
```

### Opci√≥ B: reiniciar BD i tornar-ho a crear tot (migracions + seeders)

```bash
make artisan CMD="migrate:fresh --seed"
```

‚ö†Ô∏è **Atenci√≥:** `migrate:fresh` borra totes les taules i les torna a crear (perfecte en desenvolupament, NO en producci√≥).

---

## 5.3.5. Comprovar que funciona

En la taula `users` hauries de veure:
- Un usuari amb `email = admin@example.com` i `role = administrador`
- La resta d‚Äôusuaris, si no indiquen res, tindran `role = arbitre`

