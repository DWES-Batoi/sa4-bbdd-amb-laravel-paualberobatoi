# üìò Pr√°ctica: Laravel + Docker + Makefile  
## Migraciones y modelos (`estadis` y `equips`)

En esta pr√°ctica vas a aprender a:

- Levantar un proyecto **Laravel** dentro de **Docker** usando un `Makefile`.
- Crear **migraciones** para las tablas `estadis` y `equips`.**Son archivos PHP que definen c√≥mo es la estructura de la base de datos.**
- Ejecutar las migraciones con `make`.
- Crear los **modelos** `Estadi` y `Equip`.**Son clases PHP que representan una tabla de la base de datos.)**

> ‚ÑπÔ∏è Nota: 
Nomenclatura a usar con los Nombres:
- Modelo: singular ‚Üí Equip
- Tabla: plural ‚Üí equips
- Clave for√°nea: singular + _id ‚Üí estadi_id

---

## üß± 0. Visi√≥n general del proyecto

Antes de tocar nada, tienes algo as√≠:

- Un contenedor `app` con Laravel (PHP).
- Un contenedor `db` con MySQL.
- Un contenedor `web` con Nginx.
- Un contenedor `redis`.
- Un contenedor `phpmyadmin`.
- Un `Makefile` que te simplifica la vida.


---

## üöÄ 1. Arrancar el entorno con `make`

Antes de empezar borramos contenedores `sudo docker rm -f $(sudo docker ps -aq)`

En vez de escribir comandos largos de Docker, usaremos el `Makefile`.

Sino hemos instalado Laravel:
```bash
make install
```

En tu proyecto, ejecuta:

```bash
make up
```

Esto:

- Construye las im√°genes si hace falta.
- Levanta todos los contenedores en segundo plano.

Si todo va bien, deber√≠as ver algo como:

- Contenedores levantados: `app`, `db`, `web`, `phpmyadmin`, `redis`.
- Ning√∫n error rojo en la terminal.

Si quieres ver los logs:

```bash
make logs
```

---

## üß∞ 2. El `Makefile` como ‚Äúatajo‚Äù para Artisan

En el proyecto tienes un `Makefile` parecido a este:

```make
artisan:
	@docker compose run --rm app php artisan $(CMD)
	@true
```

Eso significa:

- Cuando haces:

  ```bash
  make artisan CMD="lo-que-sea"
  ```

- En realidad se est√° ejecutando:

  ```bash
  docker compose run --rm app php artisan lo-que-sea
  ```

üí° **Traducci√≥n para clase**:
> Si quieres usar Artisan dentro de Docker ‚Üí **usa siempre `make artisan CMD="..."`**

Ejemplos:

```bash
make artisan CMD="migrate"
make artisan CMD="make:model Estadi"
make artisan CMD="make:migration create_equips_table"
```

---

## üß© 3. Dise√±o de la base de datos

Vamos a trabajar con dos tablas:

- `estadis`
- `equips`

Relaci√≥n:

> Un **estadi** puede tener **muchos equips** 
> Un **equip** pertenece a **un solo estadi**

En t√©rminos de base de datos:

- Tabla `estadis`: tendr√° un campo `id`.
- Tabla `equips`: tendr√° un campo `estadi_id` que es **clave ajena** a `estadis.id`.

---

## üèóÔ∏è 4. Crear las migraciones

### 4.1. Migraci√≥n `create_estadis_table`

Primero, crea la migraci√≥n para `estadis`:

```bash
make artisan CMD="make:migration create_estadis_table"
```

Laravel crear√° un archivo en `database/migrations`, con un nombre parecido a:

```text
2025_12_03_105000_create_estadis_table.php
```

Dentro de ese archivo, completar√°s algo as√≠ (m√°s adelante en clase):

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('estadis', function (Blueprint $table) {
            $table->id();
            $table->string('nom')->unique();
            $table->integer('capacitat');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('estadis');
    }
};
```

---

### 4.2. Migraci√≥n `create_equips_table`

Despu√©s, crea la migraci√≥n para `equips`:

```bash
make artisan CMD="make:migration create_equips_table"
```

Se crear√° un archivo similar a:

```text
2025_12_03_110022_create_equips_table.php
```

M√°s adelante lo editaremos para que quede algo as√≠:

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('equips', function (Blueprint $table) {
            $table->id();
            $table->string('nom')->unique();
            $table->foreignId('estadi_id')->constrained();
            $table->integer('titols')->default(0);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
         Schema::dropIfExists('equips');
    }
};
```

---

## ‚è±Ô∏è 5. El orden de las migraciones (muy importante)

Laravel ejecuta las migraciones en el **orden del nombre del archivo**.

Queremos esto:

1. `create_users_table` (las de Laravel por defecto)
2. `create_estadis_table` ‚úÖ
3. `create_equips_table` ‚úÖ

Porque `equips` depende de `estadis` (tiene un `estadi_id`).

‚úîÔ∏è Comprueba en la carpeta `database/migrations` que:

- El archivo `create_estadis_table` tiene una fecha/hora anterior a `create_equips_table`.
- Si no, renombra los archivos con cuidado para que `create_estadi_table` quede por encima.

---

## ‚ñ∂Ô∏è 6. Ejecutar todas las migraciones

Cuando ya tengas las migraciones listas, ejecuta:

```bash
make migrate
```

Esto:

- Crea todas las tablas pendientes en la base de datos.
- Incluye `estadis` y `equips`.

Si usas **phpMyAdmin** (por ejemplo en `http://localhost:8080`):

- Comprueba que existe la base de datos (por ejemplo `futbol`).
- Dentro ver√°s tablas como: `migrations`, `users`, `estadis`, `equips`, etc.

---

## üß± 7. Crear los modelos `Estadi` y `Equip`

Ahora que las tablas existen, vamos a crear los modelos de Eloquent.

### 7.1. Modelo `Estadi`

```bash
make artisan CMD="make:model Estadi"
```

Esto crea `app/Models/Estadi.php`.

Ejemplo de contenido:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

/**
 * MODEL ESTADI
 */
class Estadi extends Model
{
    use HasFactory;

    protected $fillable = ['nom', 'capacitat' ];
    /**
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function equips()
    {
        return $this->hasMany(Equip::class);
    }
}
```

---

### 7.2. Modelo `Equip`

```bash
make artisan CMD="make:model Equip"
```

Esto crea `app/Models/Equip.php`.

Ejemplo de contenido:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

/**
 * Model EQUIP
 */
class Equip extends Model
{
    use HasFactory;

    /**
     * @var string[]
     */
    protected $fillable = ['nom', 'estadi_id', 'titols' ];

    /**
     * @return \Illuminate\Database\Eloquent\Relations\BelongsTo
     */
    public function estadi()
    {
        return $this->belongsTo(Estadi::class);
    }

    /**
     * @return \Illuminate\Database\Eloquent\Relations\HasOne
     */
    public function manager()
    {
        return $this->hasOne(User::class   );
    }



}
```

---

## ‚úÖ 8. Resumen final para el alumnado

1. **Arrancar el entorno**

   ```bash
   make up
   ```

2. **Crear migraciones**

   ```bash
   make artisan CMD="make:migration create_estadis_table"
   make artisan CMD="make:migration create_equips_table"
   ```

3. **En `database/migrations`** 
   Editar las migraciones para definir bien las tablas y comprobar que 
   `create_estadis_table` se ejecuta **antes** que `create_equips_table`.

4. **Ejecutar migraciones**

   ```bash
   make migrate
   ```

5. **Crear modelos**

   ```bash
   make artisan CMD="make:model Estadi"
   make artisan CMD="make:model Equip"
   ```

6. **(Opcional)** Comprobar tablas en phpMyAdmin y probar las relaciones en Tinker.


# üìò Pr√°ctica: Laravel + Docker + Makefile  
## Migraciones y modelos (`estadis` y `equips`)

En esta pr√°ctica vas a aprender a:

- Levantar un proyecto **Laravel** dentro de **Docker** usando un `Makefile`.
- Crear **migraciones** para las tablas `estadis` y `equips`.**Son archivos PHP que definen c√≥mo es la estructura de la base de datos.**
- Ejecutar las migraciones con `make`.
- Crear los **modelos** `Estadi` y `Equip`.**Son clases PHP que representan una tabla de la base de datos.)**

> ‚ÑπÔ∏è Nota: 
Nomenclatura a usar con los Nombres:
- Modelo: singular ‚Üí Equip
- Tabla: plural ‚Üí equips
- Clave for√°nea: singular + _id ‚Üí estadi_id

---

## üß± 0. Visi√≥n general del proyecto

Antes de tocar nada, tienes algo as√≠:

- Un contenedor `app` con Laravel (PHP).
- Un contenedor `db` con MySQL.
- Un contenedor `web` con Nginx.
- Un contenedor `redis`.
- Un contenedor `phpmyadmin`.
- Un `Makefile` que te simplifica la vida.


---

## üöÄ 1. Arrancar el entorno con `make`

Antes de empezar borramos contenedores `sudo docker rm -f $(sudo docker ps -aq)`

En vez de escribir comandos largos de Docker, usaremos el `Makefile`.

Sino hemos instalado Laravel:
```bash
make install
```

En tu proyecto, ejecuta:

```bash
make up
```

Esto:

- Construye las im√°genes si hace falta.
- Levanta todos los contenedores en segundo plano.

Si todo va bien, deber√≠as ver algo como:

- Contenedores levantados: `app`, `db`, `web`, `phpmyadmin`, `redis`.
- Ning√∫n error rojo en la terminal.

Si quieres ver los logs:

```bash
make logs
```

---

## üß∞ 2. El `Makefile` como ‚Äúatajo‚Äù para Artisan

En el proyecto tienes un `Makefile` parecido a este:

```make
artisan:
	@docker compose run --rm app php artisan $(CMD)
	@true
```

Eso significa:

- Cuando haces:

  ```bash
  make artisan CMD="lo-que-sea"
  ```

- En realidad se est√° ejecutando:

  ```bash
  docker compose run --rm app php artisan lo-que-sea
  ```

üí° **Traducci√≥n para clase**:
> Si quieres usar Artisan dentro de Docker ‚Üí **usa siempre `make artisan CMD="..."`**

Ejemplos:

```bash
make artisan CMD="migrate"
make artisan CMD="make:model Estadi"
make artisan CMD="make:migration create_equips_table"
```

---

## üß© 3. Dise√±o de la base de datos

Vamos a trabajar con dos tablas:

- `estadis`
- `equips`

Relaci√≥n:

> Un **estadi** puede tener **muchos equips** 
> Un **equip** pertenece a **un solo estadi**

En t√©rminos de base de datos:

- Tabla `estadis`: tendr√° un campo `id`.
- Tabla `equips`: tendr√° un campo `estadi_id` que es **clave ajena** a `estadis.id`.

---

## üèóÔ∏è 4. Crear las migraciones

### 4.1. Migraci√≥n `create_estadis_table`

Primero, crea la migraci√≥n para `estadis`:

```bash
make artisan CMD="make:migration create_estadis_table"
```

Laravel crear√° un archivo en `database/migrations`, con un nombre parecido a:

```text
2025_12_03_105000_create_estadis_table.php
```

Dentro de ese archivo, completar√°s algo as√≠ (m√°s adelante en clase):

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('estadis', function (Blueprint $table) {
            $table->id();
            $table->string('nom')->unique();
            $table->integer('capacitat');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('estadis');
    }
};
```

---

### 4.2. Migraci√≥n `create_equips_table`

Despu√©s, crea la migraci√≥n para `equips`:

```bash
make artisan CMD="make:migration create_equips_table"
```

Se crear√° un archivo similar a:

```text
2025_12_03_110022_create_equips_table.php
```

M√°s adelante lo editaremos para que quede algo as√≠:

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('equips', function (Blueprint $table) {
            $table->id();
            $table->string('nom')->unique();
            $table->foreignId('estadi_id')->constrained();
            $table->integer('titols')->default(0);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
         Schema::dropIfExists('equips');
    }
};
```

---

## ‚è±Ô∏è 5. El orden de las migraciones (muy importante)

Laravel ejecuta las migraciones en el **orden del nombre del archivo**.

Queremos esto:

1. `create_users_table` (las de Laravel por defecto)
2. `create_estadis_table` ‚úÖ
3. `create_equips_table` ‚úÖ

Porque `equips` depende de `estadis` (tiene un `estadi_id`).

‚úîÔ∏è Comprueba en la carpeta `database/migrations` que:

- El archivo `create_estadis_table` tiene una fecha/hora anterior a `create_equips_table`.
- Si no, renombra los archivos con cuidado para que `create_estadi_table` quede por encima.

---

## ‚ñ∂Ô∏è 6. Ejecutar todas las migraciones

Cuando ya tengas las migraciones listas, ejecuta:

```bash
make migrate
```

Esto:

- Crea todas las tablas pendientes en la base de datos.
- Incluye `estadis` y `equips`.

Si usas **phpMyAdmin** (por ejemplo en `http://localhost:8080`):

- Comprueba que existe la base de datos (por ejemplo `futbol`).
- Dentro ver√°s tablas como: `migrations`, `users`, `estadis`, `equips`, etc.

---

## üß± 7. Crear los modelos `Estadi` y `Equip`

Ahora que las tablas existen, vamos a crear los modelos de Eloquent.

### 7.1. Modelo `Estadi`

```bash
make artisan CMD="make:model Estadi"
```

Esto crea `app/Models/Estadi.php`.

Ejemplo de contenido:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

/**
 * MODEL ESTADI
 */
class Estadi extends Model
{
    use HasFactory;

    protected $fillable = ['nom', 'capacitat' ];
    /**
     * @return \Illuminate\Database\Eloquent\Relations\HasMany
     */
    public function equips()
    {
        return $this->hasMany(Equip::class);
    }
}
```

---

### 7.2. Modelo `Equip`

```bash
make artisan CMD="make:model Equip"
```

Esto crea `app/Models/Equip.php`.

Ejemplo de contenido:

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

/**
 * Model EQUIP
 */
class Equip extends Model
{
    use HasFactory;

    /**
     * @var string[]
     */
    protected $fillable = ['nom', 'estadi_id', 'titols' ];

    /**
     * @return \Illuminate\Database\Eloquent\Relations\BelongsTo
     */
    public function estadi()
    {
        return $this->belongsTo(Estadi::class);
    }

    /**
     * @return \Illuminate\Database\Eloquent\Relations\HasOne
     */
    public function manager()
    {
        return $this->hasOne(User::class   );
    }



}
```

---

## ‚úÖ 8. Resumen final para el alumnado

1. **Arrancar el entorno**

   ```bash
   make up
   ```

2. **Crear migraciones**

   ```bash
   make artisan CMD="make:migration create_estadis_table"
   make artisan CMD="make:migration create_equips_table"
   ```

3. **En `database/migrations`** 
   Editar las migraciones para definir bien las tablas y comprobar que 
   `create_estadis_table` se ejecuta **antes** que `create_equips_table`.

4. **Ejecutar migraciones**

   ```bash
   make migrate
   ```

5. **Crear modelos**

   ```bash
   make artisan CMD="make:model Estadi"
   make artisan CMD="make:model Equip"
   ```

6. **(Opcional)** Comprobar tablas en phpMyAdmin y probar las relaciones en Tinker.


